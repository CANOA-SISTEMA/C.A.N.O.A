<script>
const PASSWORD="hegemol";
const LEN=7;
const MAX=3;

const input=document.getElementById("input");
const boxes=document.getElementById("boxes");
const symbol=document.getElementById("symbol");
const purple=document.getElementById("purple");
const download=document.getElementById("download");
const percent=document.getElementById("percent");
const fill=document.getElementById("fill");
const loginScreen=document.getElementById("loginScreen");
const system=document.getElementById("system");

let attempts=0;

/* ===== FOCO ===== */
function focusInput(){
  if(system.style.display!=="block"){
    input.focus();
  }
}

document.body.addEventListener("mouseenter",focusInput);
document.addEventListener("keydown",focusInput);

/* ===== CRIAR CAIXAS ===== */
for(let i=0;i<LEN;i++){
  const d=document.createElement("div");
  d.className="char";
  boxes.appendChild(d);
}

function update(v){
  [...boxes.children].forEach((b,i)=>{
    b.classList.toggle("filled",i<v.length);
    b.textContent=i<v.length?"â€¢":"";
  });
}

input.addEventListener("input",e=>{
  const v=e.target.value.slice(0,LEN);
  e.target.value=v;
  update(v);
});

/* ===== ENTER ===== */
input.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    if(input.value.toLowerCase()===PASSWORD){
      openSystem();
    }else{
      attempts++;
      document.getElementById("chanceNumber").textContent=MAX-attempts;
      input.value="";
      update("");
      if(attempts>=MAX) chaos();
    }
  }
});

/* ===== CAOS ===== */
function chaos(){
  symbol.style.opacity=1;
  purple.classList.add("expand");
  download.style.display="flex";
  input.disabled=true;

  let p=0;
  let interval=setInterval(()=>{
    p++;
    fill.style.width=p+"%";
    percent.textContent=p+"%";
    if(p>=100){
      clearInterval(interval);
      setTimeout(()=>{
        document.body.innerHTML="";
        document.body.style.background="#000";
        window.close();
      },1000);
    }
  },100);
}

/* ===== ABRIR SISTEMA ===== */
function openSystem(){

  // Remove tela de login completamente
  loginScreen.remove();
  input.remove();

  // Desbloqueia scroll
  document.body.style.overflow="auto";

  // Mostra sistema
  system.style.display="block";
}

/* ===== SISTEMA ===== */
function createFolder(){
  const name=prompt("Nome da pasta:");
  if(!name) return;

  const folder=document.createElement("div");
  folder.className="folder";
  folder.innerHTML=`
    <h3>${name}</h3>
    <button onclick="addNote(this)">Novo Bloco</button>
    <div class="notes"></div>
  `;
  document.getElementById("folders").appendChild(folder);
}

function addNote(btn){
  const container=btn.nextElementSibling;
  const area=document.createElement("textarea");

  area.addEventListener("paste",function(e){
    const items=e.clipboardData.items;
    for(let item of items){
      if(item.type.indexOf("image")!==-1){
        const file=item.getAsFile();
        const reader=new FileReader();
        reader.onload=function(ev){
          const img=document.createElement("img");
          img.src=ev.target.result;
          img.className="noteImage";
          container.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    }
  });

  container.appendChild(area);
}
</script>
